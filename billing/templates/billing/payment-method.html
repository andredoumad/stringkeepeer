{% extends 'base.html' %}


{% block content %}
<!-- 
<button>Click Here to Toggle</button>

<div class="textLine" style="background-color:yellow;">
 This is a yellow line.....
</div> -->


{% if payment_company == 'stripe' %}
<!-- _Stripe_ Form START -->
<div class='col-10 col-md-6 mx-auto'>
    <h1>Add Payment Method</h1>
    <div class='stripe-payment-form' data-token='{{ publish_key }}' data-next-url='{% if next_url %}{{ next_url }}{% endif %}' data-btn-title='Add New Card'></div>
</div>
<!-- _Stripe_ Form END -->
{% endif %}

======= DEBUG ==========
<hr/>
user_first_name: {{ user_first_name }}
<hr/>
user_last_name: {{ user_last_name }}
<hr/>
user_email: {{ user_email }}
<hr/>
billing_profile: {{ billing_profile }}
<hr/>
billing_profile_created: {{ billing_profile_created }}
<hr/>
braintree_customer_id: {{ braintree_customer_id }}
<hr/>
collection: {{ collection }}
<hr/>
braintree_customer_first_name: {{ braintree_customer_first_name }}
<hr/>
braintree_customer_last_name: {{ braintree_customer_last_name }}
<hr/>
braintree_customer_email: {{ braintree_customer_email }}
<hr/>
cart: {{ cart }}
<hr/>
cart_created: {{ cart_created }}
<hr/>
order_profile: {{ order_profile }}
<hr/>
order_profile_created: {{ order_profile_created }}
<hr/>
order_billing_address: {{ order_billing_address }}
<hr/>
client token: {{ client_token }}
<hr/>
======= DEBUG ==========
<hr/>
{% if payment_company != 'stripe' %}

<meta charset="utf-8">

<script src="https://js.braintreegateway.com/web/dropin/1.21.0/js/dropin.min.js"></script>
<form action="." method="post" id="payment-form">
  {% csrf_token %}
  <div id="checkoutMethods">
    <div style="margin: 10px;">
      <h2>Checkout with Braintree</h2>
      <div id="dropin-container"></div>

      <input type="hidden" id="nonce" name="payment_method_nonce" />
    </div>
  </div>
  <button>Submit Payment</button>
</form>
<script>
  var button = document.querySelector('#submit-button');

  braintree.dropin.create({
    authorization: '{{ client_token }}',
    container: '#dropin-container'
  }, function (createErr, instance) {
    button.addEventListener('click', function () {
      instance.requestPaymentMethod(function (requestPaymentMethodErr, payload) {
        // Submit payload.nonce to your server
        // Add the nonce to the form and submit
        console.log('payment method nonce is: ' + str(payload.nonce))
        document.querySelector('#nonce').value = payload.nonce;
        form.submit();
      });
    });
  });
</script>
{% endif %}

{% endblock %}
